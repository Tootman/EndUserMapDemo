<!DOCTYPE html>
<html>

<head>
	<title>Leaflet.GridLayer.Vector.Slicer demo</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
</head>

<body style='margin:0'>
	<div id="map" style="width: 100vw; height: 100vh"></div>
	<script type="text/javascript" src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
	<!-- <script type="text/javascript" src="https://unpkg.com/leaflet.vectorgrid"></script> --->
	<!--  not used <script type="text/javascript" src="../dist/Leaflet.VectorGrid.bundled.js"></script> -->
	<!-- 	<script type="text/javascript" src="Leaflet.VectorGrid.chriszrc-bundled.min.js"></script> -->
	<!-- <script type="text/javascript" src="http://leaflet.github.io/Leaflet.VectorGrid/eu-countries.js"></script> -->
	<!-- <script type="text/javascript" src="RichmondPolygonsAll.js"></script> -->
	<!-- <script type="text/javascript" src="RichmondPointsAll.js"></script> -->
	<script type="text/javascript" src="RichmondAll.js"></script>
	<!-- <script type="text/javascript" src="https://unpkg.com/geobuf@3.0.1/dist/geobuf.js"> </script> -->
	<script src="https://unpkg.com/geojson-vt@3.2.0/geojson-vt.js"></script>
	<script>
		"use strict"
		var map = L.map('map');
		let state = {}
		state.style = {}

		state.style['Amenity grass - level'] = {
			fillColor: "green"
		}
		state.style['Bench'] = {
			color: "red"
		}
		state.style['Amenity grass'] = {
			fillColor: "green"
		}
		state.style.default = {
			fillColor: "gray",
			fillOpacity: 1,
			stroke: true,
			fill: true,
			color: 'black',
			weight: 1,
			radius: 2
		}
		var cartodbAttribution = '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>';
		var positron = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
			attribution: cartodbAttribution,
			opacity: 1
		}).addTo(map);
		const propSet = f => {
			return Object.keys(f.properties)
				.map(item => {
					return `${item}: ${f.properties[item]}`;
				})
				.join("<br>");
		};

		map.setView({
			lat: 51.430269175539856,
			lng: -0.3615738451480866
		}, 15);

		//var buffer = geobuf.encode(RichmondAll, new Pbf());
		var tileIndex = geojsonvt(RichmondAll);

		/*
				const vectorGrid = L.vectorGrid.slicer(RichmondAll, {
						// slices on every change of view
						vectorTileLayerName: 'mySliced',
						generateId: true,
						tolerance: 10,
						rendererFactory: L.svg.tile,
						maxZoom: 24,
						minZoom: 14,
						vectorTileLayerStyles: {
							mySliced: (properties, zoom, geoType) => {
								const returnedStyle = state.style[properties.asset] || state.style[properties.ASSET] || state.style.default
								Object.assign(returnedStyle, {
									fillOpacity: 1,
									stroke: true,
									fill: true,
									weight: 1,
									radius: 3
								})
								return returnedStyle;
							}
						},
						interactive: true,
					})
					.on('mouseover', e => {
						const properties = e.layer.properties;
						const label = properties.Asset || properties.ASSET || properties.asset
						const popupContent = propSet(e.layer)
						L.popup()
							.setContent(`<h4>${label}</h4><hr>${popupContent}`)
							.setLatLng(e.latlng)
							.openOn(map);
						var style = {
							fillColor: 'Red',
							fillOpacity: 1,
							fillOpacity: 1,
							stroke: true,
							fill: true,
							color: 'red',
							opacity: 1,
							weight: 2,
						};
					})
					.addTo(map);
				map.setView({
					lat: 51.430269175539856,
					lng: -0.3615738451480866
				}, 15);
				*/

	</script>
</body>

</html>
